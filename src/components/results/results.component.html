<div class="results-container" *ngIf="restaurants.length > 0">
  

  <div class="cards-deck">
    <div
      *ngFor="let restaurant of restaurants; let i = index"
      class="rpg-card"
      (click)="selectRestaurant(restaurant)"
      [style.animation-delay]="i * 0.1 + 's'"
    >
      <div class="card-border">
        <div class="card-shine"></div>
        <div class="card-content">
          <div class="card-rank">â˜… {{ i + 1 }} â˜…</div>
          
          <div class="card-image">
            <div class="pizza-icon" *ngIf="!restaurant.photoUrl">ğŸ•</div>
            <img *ngIf="restaurant.photoUrl" [src]="restaurant.photoUrl" alt="Restaurant Photo" class="restaurant-photo">
          </div>
          
          <h3 class="card-title">{{ restaurant.name }}</h3>
          
          <div class="card-stats">
            <div class="stat">
              <span class="stat-label">â­ RATING</span>
              <span class="stat-value">{{ restaurant.rating.toFixed(1) }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">ğŸ’° PRICE</span>
              <span class="stat-value">{{ getPriceSymbol(restaurant.priceLevel) }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">ğŸ“ DIST</span>
              <span class="stat-value">{{ restaurant.distance.toFixed(1) }} mi</span>
            </div>
          </div>

          <div class="card-contact">
            <div class="contact-item" *ngIf="restaurant.phone">
              <a [href]="'tel:' + restaurant.phone" class="contact-link" (click)="$event.stopPropagation()">
                <span class="contact-icon">ğŸ“</span>
                <span class="contact-text">{{ restaurant.phone }}</span>
              </a>
            </div>
            <div class="contact-item" *ngIf="restaurant.website">
              <a [href]="restaurant.website" target="_blank" class="contact-link" (click)="$event.stopPropagation()">
                <span class="contact-icon">ğŸŒ</span>
                <span class="contact-text">Visit Website</span>
              </a>
            </div>
          </div>

          <div class="card-description">
            <p class="card-address">ğŸ“ {{ restaurant.address }}</p>
          </div>

          <div class="card-tags">
            <ng-container *ngFor="let cuisine of restaurant.cuisine">
              <span *ngIf="cuisine !== 'Pizza'" class="card-tag">
                {{ cuisine }}
              </span>
            </ng-container>
          </div>

          <div class="card-status" *ngIf="restaurant.openNow !== undefined">
           <!-- Elements moved to footer/actions -->
          </div>

          <div class="card-footer-actions">
            <a 
              [href]="'https://www.google.com/maps/dir/?api=1&destination=' + restaurant.latitude + ',' + restaurant.longitude" 
              target="_blank"
              class="action-btn go-btn" 
              (click)="$event.stopPropagation()">
              Go Here!
            </a>
            <button class="action-btn summary-btn" (click)="selectRestaurant(restaurant); $event.stopPropagation()">
              Summary
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="reroll-section">
    <button class="reroll-button" (click)="rerollRecommendations()" [disabled]="loading">
      <span class="reroll-icon">ğŸ²</span>
      <span class="reroll-text">{{ loading ? 'ROLLING...' : 'REROLL DECK' }}</span>
      <span class="reroll-icon">ğŸ²</span>
    </button>
  </div>
</div>

<div class="no-results" *ngIf="restaurants.length === 0">
  <p>No results yet. Try searching for pizza places near you!</p>
</div>

<div class="modal-overlay" *ngIf="selectedRestaurant" (click)="closeDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeDetails()">âœ•</button>

    <h2>{{ selectedRestaurant.name }}</h2>

    <div class="details-grid">
      <div class="detail-item">
        <strong>Rating:</strong>
        <span>{{ getStars(selectedRestaurant.rating) }} {{ selectedRestaurant.rating.toFixed(1) }}</span>
      </div>

      <div class="detail-item">
        <strong>Price:</strong>
        <span>{{ getPriceSymbol(selectedRestaurant.priceLevel) }}</span>
      </div>

      <div class="detail-item">
        <strong>Distance:</strong>
        <span>{{ selectedRestaurant.distance.toFixed(1) }} miles</span>
      </div>

      <div class="detail-item" *ngIf="selectedRestaurant.phone">
        <strong>Phone:</strong>
        <a [href]="'tel:' + selectedRestaurant.phone">{{ selectedRestaurant.phone }}</a>
      </div>

      <div class="detail-item full-width">
        <strong>Address:</strong>
        <span>{{ selectedRestaurant.address }}</span>
      </div>

      <div class="detail-item full-width" *ngIf="selectedRestaurant.website">
        <strong>Website:</strong>
        <a [href]="selectedRestaurant.website" target="_blank">Visit Website</a>
      </div>
    </div>

    <div class="ai-summary-section">
      <h3>ğŸ¤– AI-Powered Insights</h3>

      <div *ngIf="loadingSummary" class="loading">
        <p>Generating personalized summary...</p>
      </div>

      <div *ngIf="aiSummary && !loadingSummary" class="ai-content">
        <div class="summary">
          <p>{{ aiSummary.summary }}</p>
        </div>

        <div class="highlights" *ngIf="aiSummary.highlights.length > 0">
          <h4>Highlights</h4>
          <ul>
            <li *ngFor="let highlight of aiSummary.highlights">{{ highlight }}</li>
          </ul>
        </div>

        <div class="recommendations" *ngIf="aiSummary.recommendations.length > 0">
          <h4>Recommendations</h4>
          <ul>
            <li *ngFor="let rec of aiSummary.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </div>

      <div *ngIf="!loadingSummary && !aiSummary" class="error">
        <p>Unable to load AI summary at this time.</p>
      </div>
    </div>
  </div>
</div>
